# MediaMTX Configuration for School Announcements
# Optimized for ultra-low latency WebRTC streaming

# Logging
logLevel: info
logDestinations: [stdout]

# API server
api: yes
apiAddress: :9997

# Metrics
metrics: yes
metricsAddress: :9998

###############################################
# AUTHENTICATION
###############################################
# Publishing authentication (streaming TO the server)
# Set via environment variables in docker-compose.yml
# For RTMP: rtmp://server/announcements?user=stream&pass=YOUR_TOKEN
# For WHIP: Use Bearer token in OBS (Settings > Stream > Bearer Token)

# Default path authentication settings
# These apply to all paths unless overridden
pathDefaults:
  # Require authentication for publishing (streaming to server)
  publishUser: stream
  publishPass: MTX_PUBLISH_TOKEN  # Set via env var, defaults to this if not set

  # Reading (viewing) is open - no auth required for displays
  readUser:
  readPass:

# RTMP server (for OBS compatibility)
rtmp: yes
rtmpAddress: :1935
rtmpEncryption: "no"

# HLS server (for fallback compatibility if needed)
hls: yes
hlsAddress: :8888
hlsEncryption: no
hlsAlwaysRemux: no
hlsVariant: lowLatency
hlsSegmentCount: 7
hlsSegmentDuration: 1s
hlsPartDuration: 200ms
hlsSegmentMaxSize: 50M

# WebRTC server (main output for displays)
webrtc: yes
webrtcAddress: :8889
webrtcEncryption: no
webrtcAllowOrigin: "*"
webrtcTrustedProxies: []
webrtcLocalUDPAddress: :8189
webrtcLocalTCPAddress: :8189
webrtcIPsFromInterfaces: yes
webrtcIPsFromInterfacesList: []
webrtcAdditionalHosts: ["192.168.2.17"]
webrtcICEServers2: []

# Paths (streaming endpoints)
paths:
  # Main announcements stream
  announcements:
    source: publisher
    sourceOnDemand: no

  # Alias for "live" path (for RTMP compatibility)
  live:
    source: publisher
    sourceOnDemand: no

  # Allow any other stream name
  all_others:
    source: publisher
    sourceOnDemand: no

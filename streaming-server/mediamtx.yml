# MediaMTX Configuration for School Announcements
# Optimized for ultra-low latency WebRTC streaming

# Logging
logLevel: info
logDestinations: [stdout]

# API server
api: yes
apiAddress: :9997

# Metrics
metrics: yes
metricsAddress: :9998

###############################################
# AUTHENTICATION
###############################################
# Two authentication methods available:
#
# METHOD 1 (Recommended): External Auth via Admin Panel
#   - Set token in Admin Panel > Livestream > Stream Publish Token
#   - MediaMTX calls our API to validate credentials
#   - Requires AUTH_SERVER_URL to be reachable from MediaMTX
#
# METHOD 2 (Fallback): Direct Token via Environment Variable
#   - Set STREAM_PUBLISH_TOKEN in docker-compose or .env
#   - Works when containers can't communicate
#
# For OBS:
# - WHIP: Bearer Token = stream:YOUR_TOKEN
# - RTMP: Stream Key = ?user=stream&pass=YOUR_TOKEN

# External authentication (Method 1) - comment out if not using
# authMethod: external
# externalAuthenticationURL: http://school-announcements:8080/api/stream/auth

# Direct authentication (Method 2) - set via environment variable
pathDefaults:
  # Publishing requires authentication (leave empty to disable)
  # Set via MTX_PATHDEFAULTS_PUBLISHPASS env var or leave blank for no auth
  publishUser: ""
  publishPass: ""

  # Reading (viewing) is open - no auth required for displays
  readUser: ""
  readPass: ""

# RTMP server (for OBS compatibility)
rtmp: yes
rtmpAddress: :1935
rtmpEncryption: "no"

# HLS server (for fallback compatibility if needed)
hls: yes
hlsAddress: :8888
hlsEncryption: no
hlsAlwaysRemux: no
hlsVariant: lowLatency
hlsSegmentCount: 7
hlsSegmentDuration: 1s
hlsPartDuration: 200ms
hlsSegmentMaxSize: 50M

# WebRTC server (main output for displays)
webrtc: yes
webrtcAddress: :8889
webrtcEncryption: no
webrtcAllowOrigin: "*"
webrtcTrustedProxies: []
webrtcLocalUDPAddress: :8189
webrtcLocalTCPAddress: :8189
webrtcIPsFromInterfaces: yes
webrtcIPsFromInterfacesList: []
webrtcAdditionalHosts: ["192.168.2.17"]
webrtcICEServers2: []

# Paths (streaming endpoints)
paths:
  # Main announcements stream
  announcements:
    source: publisher
    sourceOnDemand: no

  # Alias for "live" path (for RTMP compatibility)
  live:
    source: publisher
    sourceOnDemand: no

  # Allow any other stream name
  all_others:
    source: publisher
    sourceOnDemand: no
